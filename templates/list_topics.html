{% extends "base.html" %}
{% load compress static i18n static %}

{% block title %}{% trans "Topics" %}{% endblock %}

{% block main_class %}topic-list{% endblock %}

{% block content %}

<div class="box">
    <header class="page-heading">
        <h1>{% trans "Topics" %}</h1>
    </header>
    <div class="featured-issues">
    </div>

<div class="feed-filters">
    <h4>{% trans "Browse keywords" %}</h4>
    <form class="form-horizontal">
        <div class="form-group">
            <label class="col-lg-2  control-label">{% trans "Search" %}</label>
            <div class="col-lg-10">
                <input type="text" class="form-control" placeholder="{% trans "Search keywords" %}">
            </div>
            <p>
        </div>
        <div class="form-group">
            <label class="col-lg-2  control-label">{% trans "Sort" %}</label>
            <div class="col-lg-10">
                <div class="btn-toolbar">
                    <div class="btn-group" data-toggle="buttons-checkbox">
                        <button class="btn  btn-default  js-tooltip  active" type="button" title="{% trans "Alphabetical" %}">{% trans "Alphabetical" %}</button>
                        <button class="btn  btn-default  js-tooltip" type="button" title="{% trans "With latest activity" %}">{% trans "With latest activity" %}</button>
                        <button class="btn  btn-default  js-tooltip" type="button" title="{% trans "Most interesting" %}">{% trans "Most interesting" %}</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<div class="issue-tag-list" id="issue-tag-list">
</div>

</div> <!-- box -->

<script type="text/template" id="featured-topics-template">
    <ul class="nav nav-tabs">
    <% _.each(tabs, function(tab) { %>
        <li>
            <a data-tab="<%= tab.id %>" href="#"><%= tab.name %></a>
        </li>
    <% }); %>
    </ul>
    <div class="tab-content">
        <div class="tab-pane active">
        </div>
    </div>
{% comment %}
    <% _.each(tabs, function(tab) { %>
        <div data-tab="<%= tab.id %>" class="tab-pane">
            <div class="tagcloud tagcloud-navi">
            </div>
        </div>
    <% }); %>
{% endcomment %}
    </div>
</script>

<script type="text/javascript">

FEATURED_TABS = [
    {
        id: 'recent',
        name: "{% trans 'Active recently' %}",
        filters: {
            since: 'month'
        },
        data: {{recent_topics_json|safe}}
    }, {
        id: 'term',
        name: "{% trans 'Active this term' %}",
        filters: {
            since: 'term'
        }
    }, {
        id: 'alltime',
        name: "{% trans 'All time active' %}"
    }
];

</script>

<script type="text/template" id="tag-section-template">
    <div class="tag-list-divider"><%= section %></div>
    <ul class="tag-list">
        <% _.each(tags, function (tag) { %>
        <li>
        <a href="<%= tag.get_view_url() %>"><%= tag.get("name") %></a>
        </li>
        <% }); %>
    </ul>
</script>

{% compress js %}
<script type="text/coffeescript">

class KeywordListView extends Backbone.View
    el: "#issue-tag-list"
    template: _.template $("#tag-section-template").html()
    
    groupings:
        name:
            sort: (kw) => kw.get("name")
            group: (kw) => kw.get("name")[0]

    initialize: ->
        @tags = new KeywordList
        @tags.filters.limit = 0
        @tags.filters.activity = true
        
        @grouping = @groupings["name"]
        @tags.comparator = @grouping.sort
        
        @$el.spin()
        @tags.on "reset", @render
        @tags.fetch reset: true
    

    render: =>
        @$el.empty()
        grouped = @tags.groupBy @grouping.group
        #grouped = _.sortBy grouped,
        for grp, kws of grouped
            @$el.append(@template section: grp, tags: kws)
$ ->
    new KeywordListView

</script>
{% endcompress %}

<script type="text/javascript" src="{% static "js/vendor/jquery.quicksand.js" %}"></script>

{% compress js %}
<script type="text/coffeescript" src="{% static "js/models.coffee" %}"></script>
{% endcompress %}
{% compress js %}
<script type="text/coffeescript" src="{% static "js/topics.coffee" %}"></script>
{% endcompress %}

{% endblock %}
